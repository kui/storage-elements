{"version":3,"sources":["webpack:///webpack/bootstrap 3508d7112b745661b8a9","webpack:///./src/storage-elements-registerer.js","webpack:///./src/area-handler.js","webpack:///./src/storage-form.js","webpack:///./src/chrome-storage-handler.js","webpack:///./src/storage-items.js","webpack:///./src/utils.js","webpack:///./src/web-storage-handler.js"],"names":[],"mappings":"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","file":"storage-elements.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3508d7112b745661b8a9","/* global chrome */\n\nimport StorageForm from \"./storage-form\";\nimport * as i from \"./storage-items\";\nimport * as ah from \"./area-handler\";\nimport WebStorageAreaHandler from \"./web-storage-handler\";\nimport ChromeStorageAreaHandler from \"./chrome-storage-handler\";\n\n// Register area handlers\nif (localStorage)\n  ah.registerHandler(\"local-storage\", new WebStorageAreaHandler(localStorage));\nif (sessionStorage)\n  ah.registerHandler(\"session-storage\", new WebStorageAreaHandler(sessionStorage));\nif (chrome && chrome.storage) {\n  if (chrome.storage.local)\n    ah.registerHandler(\"chrome-local\", new ChromeStorageAreaHandler(chrome.storage.local));\n  if (chrome.storage.sync)\n    ah.registerHandler(\"chrome-sync\", new ChromeStorageAreaHandler(chrome.storage.sync));\n}\n\n// Register custom elements\n[[\"storage-form\", StorageForm, \"form\"],\n [\"storage-input\", i.StorageInputElement, \"input\"],\n [\"storage-textarea\", i.StorageTextAreaElement, \"textarea\"],\n [\"storage-select\", i.StorageSelectElement, \"select\"],\n].forEach(([name, customElement, extendee]) => {\n  // Custom Element v1 seems not to working right on Google Chrome 55\n  // customElements.define(name, ce, { extends: ex });\n\n  // Custom Element v0\n  // $FlowFixMe Avoid to affect code of `storage-form.js` by Custom Element v0\n  Object.defineProperty(customElement, \"extends\", { get: () => extendee });\n  document.registerElement(name, customElement);\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/storage-elements-registerer.js","export type Area = string;\n\nexport interface AreaHandler {\n  read(name: string): Promise<?string>;\n  write(name: string, newValue: string): Promise<void>;\n  removeItem(name: string): Promise<void>;\n}\n\nconst handlers: { [area: Area]: AreaHandler } = {};\n\nexport function registerHandler(area: Area, handler: AreaHandler): void {\n  if (handlers[area]) {\n    throw Error(`Already registered handler for \"${area}\"`);\n  }\n  handlers[area] = handler;\n}\n\nexport function findHandler(area: Area): ?AreaHandler {\n  return handlers[area];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/area-handler.js","import * as u from \"./utils\";\n\ndeclare interface StorableElement extends HTMLElement {\n  name?: string;\n  checked?: boolean;\n  store(): any;\n}\n\nexport default class HTMLStorageFormElement extends HTMLFormElement {\n  constructor() {\n    super();\n  }\n\n  createdCallback() {\n    this.addEventListener(\"submit\", (event) => {\n      event.preventDefault();\n      this.store();\n    });\n    if (this.isAutoSyncEnabled())\n      this.periodicalSync();\n  }\n\n  async store(): Promise<void> {\n    // Avoid to store twice by \"name\"\n    const storingItems: Map<string, StorableElement> = Array\n          .from(this.elements)\n          .reduce((map, element: StorableElement) => {\n            if (!(element.store instanceof Function)) return map;\n            const name = element.name;\n            if (!name) return map;\n            if (!map.has(name)) {\n              map.set(name, element);\n              return map;\n            }\n            // Overrite a storing element if \"checked\" element was found.\n            if (element.checked) {\n              map.set(name, element);\n              return map;\n            }\n            return map;\n          }, new Map());\n\n    await Promise.all(Array.from(storingItems.values()).map((e) => e.store()));\n  }\n\n  async sync(): Promise<void> {\n    const d = this.getSyncDelay();\n    if (d == null) return Promise.reject(Error(\"Require positive integer value 'sync-delay' attribute\"));\n    if (d <= 0) return Promise.reject(Error(`Require positive number for \"sync-delay\": ${d}`));\n\n    await u.sleep(d);\n\n    if (!this.isAutoSyncEnabled()) {\n      return;\n    }\n\n    return this.store();\n  }\n\n  isAutoSyncEnabled(): boolean {\n    return this.hasAttribute(\"sync\") && this.getSyncDelay() !== null;\n  }\n\n  getSyncDelay() {\n    const a = this.getAttribute(\"sync-delay\");\n    if (!a) return null;\n    const d = parseInt(a);\n    if (d <= 0) return null;\n    return d;\n  }\n\n  async periodicalSync() {\n    while (this.isAutoSyncEnabled()) {\n      await this.sync();\n    }\n  }\n\n  attachedCallback() {}\n\n  detachedCallback() {}\n\n  static get observedAttributes() {\n    return [\n      \"sync\",\n      \"sync-delay\",\n      // \"area\",\n    ];\n  }\n\n  attributeChangedCallback(attrName: string) {\n    if (attrName === \"sync\" ||\n        attrName === \"sync-delay\") {\n      this.periodicalSync();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/storage-form.js","export default class ChromeStorageAreaHandler {\n  storage: ChromeStorageArea;\n\n  constructor(storage: ChromeStorageArea) {\n    this.storage = storage;\n  }\n\n  read(name: string): Promise<?string> {\n    return new Promise((resolve) => this.storage.get(name, (v) => resolve(v[name])));\n  }\n\n  write(name: string, newValue: string): Promise<void> {\n    return new Promise((resolve) => this.storage.set({ [name]: newValue }, resolve));\n  }\n\n  removeItem(name: string): Promise<void> {\n    return new Promise((resolve) => this.storage.remove(name, resolve));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/chrome-storage-handler.js","import * as ah from \"./area-handler\";\nimport HTMLStorageFormElement from \"./storage-form\";\n\ndeclare interface ItemElement extends HTMLElement {\n  value: string,\n  name: string,\n  form: HTMLFormElement | null,\n  type?: string,\n  checked?: boolean;\n}\n\ndeclare interface StorageItemElement extends ItemElement {\n  load(): Promise<void>;\n  store(): Promise<void>;\n  getAreaHandler(): ah.AreaHandler;\n  getForm(): HTMLStorageFormElement;\n}\n\nexport function mixinStorageElement(c: Class<ItemElement>): Class<StorageItemElement> {\n  return class extends c {\n    constructor() {\n      super();\n    }\n\n    createdCallback() {\n      if (this.name) this.load();\n    }\n\n    attachedCallback() {\n      this.load();\n    }\n\n    async load(): Promise<void> {\n      if (!this.name) throw Error(\"\\\"name\\\" attribute are required\");\n\n      const v = await this.getAreaHandler().read(this.name);\n      this.value = v ? v : \"\";\n    }\n\n    getAreaHandler(): ah.AreaHandler {\n      const a: ?ah.Area = this.getArea();\n      if (!a) throw Error(\"\\\"area\\\" attribute is required\");\n\n      const h = ah.findHandler(a);\n      if (!h) throw Error(`Unsupported area: ${a}`);\n      return h;\n    }\n\n    getArea(): ?ah.Area {\n      const a = this.getAttribute(\"area\");\n      if (a) return a;\n\n      const fa = this.getForm().getAttribute(\"area\");\n      if (fa) return fa;\n      return null;\n    }\n\n    getForm(): HTMLStorageFormElement {\n      const f = this.form;\n      if (f instanceof HTMLStorageFormElement) return f;\n      throw Error(`'${String(this.getAttribute(\"is\"))}' requires ` +\n                  \"'<form is=\\\"storage-form\\\" ...>' as a parent Node\");\n    }\n\n    async store(): Promise<void> {\n      if (!this.name) throw Error(\"\\\"name\\\" attribute are required\");\n\n      await this.getAreaHandler().write(this.name, this.value);\n    }\n\n    detachedCallback() {}\n  };\n}\n\nexport const StorageTextAreaElement = mixinStorageElement(HTMLTextAreaElement);\nexport const StorageSelectElement = mixinStorageElement(HTMLSelectElement);\n\nconst MixinedInputElement = mixinStorageElement(HTMLInputElement);\nexport class StorageInputElement extends MixinedInputElement {\n\n  // DONOT use \"async\" keyword.\n  // Because \"async\" function transpiler does not support \"super\".\n  load(): Promise<void> {\n    if (!this.name) throw Error(\"\\\"name\\\" attribute are required\");\n\n    if (this.type === \"checkbox\") {\n      return this.getAreaHandler().read(this.name).then((v) => {\n        this.checked = v != null;\n        // Update stored value to current checkbox value\n        this.store();\n      });\n    }\n\n    if (this.type === \"radio\") {\n      return this.getAreaHandler().read(this.name).then((v) => {\n        this.checked = this.value === v;\n      });\n    }\n\n    return super.load();\n  }\n\n  store(): Promise<void> {\n    if (!this.name) throw Error(\"\\\"name\\\" attribute are required\");\n\n    if (this.type === \"checkbox\") {\n      if (this.checked) return super.store();\n      return this.deleteStore();\n    }\n\n    if (this.type === \"radio\") {\n      if (this.checked) return super.store();\n      return Promise.resolve();\n    }\n\n    return super.store();\n  }\n\n  deleteStore(): Promise<void> {\n    return this.getAreaHandler().removeItem(this.name);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/storage-items.js","export function sleep(msec: number): Promise<void> {\n  return new Promise((resolve) => {\n    setInterval(() => resolve(), msec);\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","export default class WebStorageAreaHandler {\n  storage: Storage;\n\n  constructor(storage: Storage) {\n    this.storage = storage;\n  }\n\n  read(name: string): Promise<?string> {\n    return Promise.resolve(this.storage.getItem(name));\n  }\n\n  write(name: string, newValue: string): Promise<void> {\n    this.storage.setItem(name, newValue);\n    return Promise.resolve();\n  }\n\n  removeItem(name: string): Promise<void> {\n    this.storage.removeItem(name);\n    return Promise.resolve();\n  }\n}\n\n\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/web-storage-handler.js"],"sourceRoot":""}