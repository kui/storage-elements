(function(e){function h(j){if(i[j])return i[j].exports;var k=i[j]={exports:{},id:j,loaded:!1};return e[j].call(k.exports,k,k.exports,h),k.loaded=!0,k.exports}var i={};return h.m=e,h.c=i,h.p="",h(0)})([function(e,h,i){"use strict";var j=i(4),k=function(o){return o&&o.__esModule?o:{default:o}}(j),l=i(1),m=function(o){if(o&&o.__esModule)return o;var p={};if(null!=o)for(var q in o)Object.prototype.hasOwnProperty.call(o,q)&&(p[q]=o[q]);return p.default=o,p}(l);localStorage&&m.registerHandler("local-storage",new m.WebStorageAreaHandler(localStorage)),sessionStorage&&m.registerHandler("session-storage",new m.WebStorageAreaHandler(sessionStorage)),chrome&&chrome.storage&&(chrome.storage.local&&m.registerHandler("chrome-local",new m.ChromeStorageAreaHandler(chrome.storage.local)),chrome.storage.sync&&m.registerHandler("chrome-sync",new m.ChromeStorageAreaHandler(chrome.storage.sync))),Object.defineProperty(k.default,"extends",{get:()=>"form"}),document.registerElement("storage-form",k.default)},function(e,h){"use strict";h.__esModule=!0,h.registerHandler=function(k,l){if(i[k])throw Error(`Already registered handler for "${k}"`);i[k]=l},h.findHandler=function(k){return i[k]};var i={};h.WebStorageAreaHandler=class{constructor(k){this.storage=k}read(k){return Promise.resolve(this.storage.getItem(k))}write(k,l){return this.storage.setItem(k,l),Promise.resolve()}remove(k){return this.storage.removeItem(k),Promise.resolve()}},h.ChromeStorageAreaHandler=class{constructor(k){this.storage=k}read(k){return new Promise(l=>this.storage.get(k,m=>l(m[k])))}write(k,l){return new Promise(m=>this.storage.set({[k]:l},m))}remove(k){return new Promise(l=>this.storage.remove(k,l))}}},function(e,h){"use strict";h.__esModule=!0,h.sleep=function(l){var m=void 0;return new i(n=>{m=setTimeout(()=>n(),l)},()=>{clearTimeout(m)})},h.dedup=function(l){var m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:(n,o)=>n===o;return l.reduce((n,o)=>{if(n.some(p=>m(p,o)));return n.concat(o)},[])},h.subtractSet=function(l,m){return new Set(Array.from(l).filter(n=>!m.has(n)))};class i extends Promise{constructor(k,l){super(k),this.cancellFunction=l}cancell(){this.cancellFunction()}}h.CancellablePromise=i;class j extends Map{*flattenValues(){for(var k=this.values(),l=Array.isArray(k),m=0,k=l?k:k[Symbol.iterator]();;){var n;if(l){if(m>=k.length)break;n=k[m++]}else{if(m=k.next(),m.done)break;n=m.value}var o=n;for(var p=o,q=Array.isArray(p),r=0,p=q?p:p[Symbol.iterator]();;){var s;if(q){if(r>=p.length)break;s=p[r++]}else{if(r=p.next(),r.done)break;s=r.value}var t=s;yield t}}}}h.ArrayValueMap=class extends j{add(l,m){var n=this.get(l);return n||(n=[],this.set(l,n)),n.push(m),this}},h.SetValueMap=class extends j{add(l,m){var n=this.get(l);return n||(n=new Set,this.set(l,n)),n.add(m),this}}},function(e,h,i){"use strict";function j(s){return function(){var t=s.apply(this,arguments);return new Promise(function(v,w){function x(y,z){try{var A=t[y](z),B=A.value}catch(C){return void w(C)}return A.done?void v(B):Promise.resolve(B).then(function(C){x("next",C)},function(C){x("throw",C)})}return x("next")})}}function k(){for(var s=arguments.length,t=Array(s),v=0;v<s;v++)t[v]=arguments[v];for(var w=t,x=Array.isArray(w),y=0,w=x?w:w[Symbol.iterator]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{if(y=w.next(),y.done)break;z=y.value}var A=z,B=A();if(null!=B)return B}return null}function l(s,t){for(var v=s.v.values(),w=Array.isArray(v),x=0,v=w?v:v[Symbol.iterator]();;){var y;if(w){if(x>=v.length)break;y=v[x++]}else{if(x=v.next(),x.done)break;y=x.value}var z=y;if(z.name===t)return z.value}return null}h.__esModule=!0;var m=(()=>{var s=j(function*(t,v){yield Promise.all(v.map((()=>{var w=j(function*(x){yield o(t,x),yield p(t,x)});return function(){return w.apply(this,arguments)}})()))});return function(){return s.apply(this,arguments)}})(),n=(()=>{var s=j(function*(t,v){for(;t.lock;)yield t.lock;t.lock=v(),yield t.lock,t.lock=null});return function(){return s.apply(this,arguments)}})(),o=(()=>{var s=j(function*(t,v){var w=v.name,x=yield t.s.read(w),y=t.v.get(v);y||(y={name:v.name,value:null},t.v.set(v,y)),(y.name!==w||y.value!==x)&&(t.f.write(v,x),y.name=w,y.value=x)});return function(){return s.apply(this,arguments)}})(),p=(()=>{var s=j(function*(t,v){var w=v.name,x=k(function(){return t.f.read(v)},function(){return l(t,w)}),y=t.v.get(v);y||(y={name:v.name,value:null},t.v.set(v,y)),(y.name!==w||y.value!==x)&&(null==x?yield t.s.remove(w):yield t.s.write(w,x),y.name=w,y.value=x)});return function(){return s.apply(this,arguments)}})(),q=i(2),r=function(t){if(t&&t.__esModule)return t;var v={};if(null!=t)for(var w in t)Object.prototype.hasOwnProperty.call(t,w)&&(v[w]=t[w]);return v.default=t,v}(q);h.default=class{constructor(t,v){this.v=new Map,this.s=t,this.f=v,this.lock=null}sync(t){var v=this;return j(function*(){yield n(v,function(){return m(v,t)})})()}submit(t){var v=this;return j(function*(){yield n(v,function(){return Promise.all(t.map((()=>{var w=j(function*(x){yield p(v,x)});return function(){return w.apply(this,arguments)}})()))})})()}scan(t){var v=this;return j(function*(){yield n(v,j(function*(){var w=r.subtractSet(new Set(t),new Set(v.v.keys()));yield m(v,Array.from(w))}))})()}remove(t){var v=this;return j(function*(){yield n(v,j(function*(){for(var w=t,x=Array.isArray(w),y=0,w=x?w:w[Symbol.iterator]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{if(y=w.next(),y.done)break;z=y.value}var A=z;v.v.delete(A)}}))})()}}},function(e,h,i){"use strict";function j(I){if(I&&I.__esModule)return I;var J={};if(null!=I)for(var K in I)Object.prototype.hasOwnProperty.call(I,K)&&(J[K]=I[K]);return J.default=I,J}function k(I){return function(){var J=I.apply(this,arguments);return new Promise(function(K,L){function M(N,O){try{var P=J[N](O),Q=P.value}catch(R){return void L(R)}return P.done?void K(Q):Promise.resolve(Q).then(function(R){M("next",R)},function(R){M("throw",R)})}return M("next")})}}function l(I){return I.hasAttribute("autosync")}function m(I,J){var K=[J,...Array.from(J.querySelectorAll("*"))].filter(R=>null!=R.value&&null!=R.name),L=function(S){var T=new MutationObserver(()=>x(I,[S]));T.observe(S,{attributes:!0,atributeFilter:["name"]}),I.componentObservers.set(S,T)};for(var M=K,N=Array.isArray(M),O=0,M=N?M:M[Symbol.iterator]();;){var P;if(N){if(O>=M.length)break;P=M[O++]}else{if(O=M.next(),O.done)break;P=O.value}var Q=P;L(Q)}}function n(I,J){var K=[J,...Array.from(J.querySelectorAll("*"))];for(var L=K,M=Array.isArray(L),N=0,L=M?L:L[Symbol.iterator]();;){var O;if(M){if(N>=L.length)break;O=L[N++]}else{if(N=L.next(),N.done)break;O=N.value}var P=O,Q=I.componentObservers.get(P);null==Q||(I.componentObservers.delete(P),Q.disconnect())}}function o(I){return Array.from(I.elements).filter(J=>J.name)}function p(I,J){var K=I.type;return"checkbox"===K||"radio"===K?void(I.checked=J===I.value):void(null==J||null==I.value||(I.value=J))}function q(I){var J=I.type;return"checkbox"===J||"radio"===J?I.checked?I.value:null:I.value}function r(I){var J=I.area;if(!J)return console.error("Require 'area' attribute"),null;var K=E.findHandler(J);return K?K:(console.error("No such area handler: area=%s",I.area),null)}function s(I,J){var K=I.getAttribute(J);return K?K:""}function t(I,J,K){null==K||I.setAttribute(J,K)}function v(I){return Array.from(function*(){for(var J=I,K=Array.isArray(J),L=0,J=K?J:J[Symbol.iterator]();;){var M;if(K){if(L>=J.length)break;M=J[L++]}else{if(L=J.next(),L.done)break;M=L.value}var N=M;for(var O=N,P=Array.isArray(O),Q=0,O=P?O:O[Symbol.iterator]();;){var R;if(P){if(Q>=O.length)break;R=O[Q++]}else{if(Q=O.next(),Q.done)break;R=Q.value}var S=R;yield S}}}())}h.__esModule=!0;var w=(()=>{var I=k(function*(J){J.binder&&(yield J.binder.submit(o(J)))});return function(){return I.apply(this,arguments)}})(),x=(()=>{var I=k(function*(J,K){J.binder&&(yield J.binder.sync(K?K:o(J)))});return function(){return I.apply(this,arguments)}})(),y=(()=>{var I=k(function*(J){J.binder&&(yield J.binder.scan(o(J)))});return function(){return I.apply(this,arguments)}})(),z=(()=>{var I=k(function*(J,K){J.binder&&(yield J.binder.remove(K))});return function(){return I.apply(this,arguments)}})(),A=(()=>{var I=k(function*(J){J.binder=null;var K=r(J);K&&(J.binder=new G.default(K,{write:p,read:q}),yield x(J))});return function(){return I.apply(this,arguments)}})(),B=i(2),C=j(B),D=i(1),E=j(D),F=i(3),G=function(J){return J&&J.__esModule?J:{default:J}}(F);class H extends HTMLFormElement{get autosync(){var I=parseInt(s(this,"autosync"));return 0<I?I:700}set autosync(I){t(this,"autosync",I)}get area(){return s(this,"area")}set area(I){t(this,"area",I)}constructor(){super()}createdCallback(){var I=this;A(this),this.componentObservers=new Map,this.addEventListener("submit",J=>{J.preventDefault(),w(this)}),window.addEventListener("unload",()=>{l(this)&&x(this)}),new MutationObserver(J=>{console.debug("scan by form MutationObserver: ",this),y(this);var K=v(J.map(W=>W.addedNodes)).filter(W=>W instanceof HTMLElement);if(0<K.length)for(var L=K,M=Array.isArray(L),N=0,L=M?L:L[Symbol.iterator]();;){var O;if(M){if(N>=L.length)break;O=L[N++]}else{if(N=L.next(),N.done)break;O=N.value}var P=O;m(this,P)}var Q=v(J.map(W=>W.removedNodes)).filter(W=>W instanceof HTMLElement);if(0<Q.length){z(this,Q.filter(W=>W.name));for(var R=Q,S=Array.isArray(R),T=0,R=S?R:R[Symbol.iterator]();;){var U;if(S){if(T>=R.length)break;U=R[T++]}else{if(T=R.next(),T.done)break;U=T.value}var V=U;n(this,V)}}}).observe(this,{childList:!0,subtree:!0}),y(this),k(function*(){for(;;)yield C.sleep(I.autosync),l(I)?yield x(I):yield y(I)})()}attachedCallback(){y(this)}static get observedAttributes(){return["autosync","area"]}attributeChangedCallback(I){switch(I){case"autosync":break;case"area":A(this);}}}h.default=H}]);
//# sourceMappingURL=storage-elements.js.map