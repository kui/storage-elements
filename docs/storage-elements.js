(function(e){function h(k){if(j[k])return j[k].exports;var l=j[k]={exports:{},id:k,loaded:!1};return e[k].call(l.exports,l,l.exports,h),l.loaded=!0,l.exports}var j={};return h.m=e,h.c=j,h.p="",h(0)})([function(e,h,j){"use strict";var k=j(4),l=function(n){return n&&n.__esModule?n:{default:n}}(k);Object.defineProperty(l.default,"extends",{get:()=>"form"}),document.registerElement("storage-form",l.default)},function(e,h){"use strict";h.__esModule=!0,h.sleep=function(m){var n=void 0;return new j(o=>{n=setTimeout(()=>o(),m)},()=>{clearTimeout(n)})},h.dedup=function(m){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:(o,p)=>o===p;return m.reduce((o,p)=>{if(o.some(q=>n(q,p)));return o.concat(p)},[])},h.subtractSet=function(m,n){return new Set(Array.from(m).filter(o=>!n.has(o)))};class j extends Promise{constructor(l,m){super(l),this.cancellFunction=m}cancell(){this.cancellFunction()}}h.CancellablePromise=j;class k extends Map{*flattenValues(){for(var l=this.values(),m=Array.isArray(l),n=0,l=m?l:l[Symbol.iterator]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{if(n=l.next(),n.done)break;o=n.value}var p=o;for(var q=p,r=Array.isArray(q),s=0,q=r?q:q[Symbol.iterator]();;){var t;if(r){if(s>=q.length)break;t=q[s++]}else{if(s=q.next(),s.done)break;t=s.value}var v=t;yield v}}}}h.ArrayValueMap=class extends k{add(m,n){var o=this.get(m);return o||(o=[],this.set(m,o)),o.push(n),this}},h.SetValueMap=class extends k{add(m,n){var o=this.get(m);return o||(o=new Set,this.set(m,o)),o.add(n),this}}},function(e,h){"use strict";function j(n,o){if(k[n])throw Error(`Already registered handler for "${n}"`);k[n]=o}h.__esModule=!0,h.registerHandler=j,h.findHandler=function(o){return k[o]};var k={};class l{constructor(n){this.storage=n}read(n){return Promise.resolve(this.storage.getItem(n))}write(n,o){return this.storage.setItem(n,o),Promise.resolve()}remove(n){return this.storage.removeItem(n),Promise.resolve()}}h.WebStorageAreaHandler=l,localStorage&&j("local-storage",new l(localStorage)),sessionStorage&&j("session-storage",new l(sessionStorage));class m{constructor(n){this.storage=n}read(n){return new Promise(o=>this.storage.get(n,p=>o(p[n])))}write(n,o){return new Promise(p=>this.storage.set({[n]:o},p))}remove(n){return new Promise(o=>this.storage.remove(n,o))}}h.ChromeStorageAreaHandler=m,chrome&&chrome.storage&&(chrome.storage.local&&j("chrome-local",new m(chrome.storage.local)),chrome.storage.sync&&j("chrome-sync",new m(chrome.storage.sync)))},function(e,h,j){"use strict";function k(t){return function(){var v=t.apply(this,arguments);return new Promise(function(w,x){function y(z,A){try{var B=v[z](A),C=B.value}catch(D){return void x(D)}return B.done?void w(C):Promise.resolve(C).then(function(D){y("next",D)},function(D){y("throw",D)})}return y("next")})}}function l(){for(var t=arguments.length,v=Array(t),w=0;w<t;w++)v[w]=arguments[w];for(var x=v,y=Array.isArray(x),z=0,x=y?x:x[Symbol.iterator]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{if(z=x.next(),z.done)break;A=z.value}var B=A,C=B();if(null!=C)return C}return null}function m(t,v){for(var w=t.v.values(),x=Array.isArray(w),y=0,w=x?w:w[Symbol.iterator]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{if(y=w.next(),y.done)break;z=y.value}var A=z;if(A.name===v)return A.value}return null}h.__esModule=!0;var n=(()=>{var t=k(function*(v,w){yield Promise.all(w.map((()=>{var x=k(function*(y){yield p(v,y),yield q(v,y)});return function(){return x.apply(this,arguments)}})()))});return function(){return t.apply(this,arguments)}})(),o=(()=>{var t=k(function*(v,w){for(;v.lock;)yield v.lock;v.lock=w(),yield v.lock,v.lock=null});return function(){return t.apply(this,arguments)}})(),p=(()=>{var t=k(function*(v,w){var x=w.name,y=yield v.s.read(x),z=v.v.get(w);z||(z={name:w.name,value:null},v.v.set(w,z)),(z.name!==x||z.value!==y)&&(v.f.write(w,y),z.name=x,z.value=y)});return function(){return t.apply(this,arguments)}})(),q=(()=>{var t=k(function*(v,w){var x=w.name,y=l(function(){return v.f.read(w)},function(){return m(v,x)}),z=v.v.get(w);z||(z={name:w.name,value:null},v.v.set(w,z)),(z.name!==x||z.value!==y)&&(null==y?yield v.s.remove(x):yield v.s.write(x,y),z.name=x,z.value=y)});return function(){return t.apply(this,arguments)}})(),r=j(1),s=function(v){if(v&&v.__esModule)return v;var w={};if(null!=v)for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(w[x]=v[x]);return w.default=v,w}(r);h.default=class{constructor(v,w){this.v=new Map,this.s=v,this.f=w,this.lock=null}sync(v){var w=this;return k(function*(){yield o(w,function(){return n(w,v)})})()}submit(v){var w=this;return k(function*(){yield o(w,function(){return Promise.all(v.map((()=>{var x=k(function*(y){yield q(w,y)});return function(){return x.apply(this,arguments)}})()))})})()}scan(v){var w=this;return k(function*(){yield o(w,k(function*(){var x=s.subtractSet(new Set(v),new Set(w.v.keys()));yield n(w,Array.from(x))}))})()}remove(v){var w=this;return k(function*(){yield o(w,k(function*(){for(var x=v,y=Array.isArray(x),z=0,x=y?x:x[Symbol.iterator]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{if(z=x.next(),z.done)break;A=z.value}var B=A;w.v.delete(B)}}))})()}}},function(e,h,j){"use strict";function k(K){if(K&&K.__esModule)return K;var L={};if(null!=K)for(var M in K)Object.prototype.hasOwnProperty.call(K,M)&&(L[M]=K[M]);return L.default=K,L}function l(K){return function(){var L=K.apply(this,arguments);return new Promise(function(M,N){function O(P,Q){try{var R=L[P](Q),S=R.value}catch(T){return void N(T)}return R.done?void M(S):Promise.resolve(S).then(function(T){O("next",T)},function(T){O("throw",T)})}return O("next")})}}function m(K){return class extends K{get autosync(){var L=parseInt(v(this,"autosync"));return 0<L?L:700}set autosync(L){w(this,"autosync",L)}get area(){return v(this,"area")}set area(L){w(this,"area",L)}constructor(){super()}createdCallback(){var L=this;C(this),this.componentObservers=new Map,this.addEventListener("submit",M=>{M.preventDefault(),y(this)}),window.addEventListener("unload",()=>{n(this)&&z(this)}),new MutationObserver(M=>{console.debug("scan by form MutationObserver: ",this),A(this);var N=x(M.map(Z=>Z.addedNodes)).filter(Z=>Z instanceof HTMLElement);if(0<N.length)for(var O=N,P=Array.isArray(O),Q=0,O=P?O:O[Symbol.iterator]();;){var R;if(P){if(Q>=O.length)break;R=O[Q++]}else{if(Q=O.next(),Q.done)break;R=Q.value}var S=R;o(this,S)}var T=x(M.map(Z=>Z.removedNodes)).filter(Z=>Z instanceof HTMLElement);if(0<T.length){B(this,T.filter(Z=>Z.name));for(var U=T,V=Array.isArray(U),W=0,U=V?U:U[Symbol.iterator]();;){var X;if(V){if(W>=U.length)break;X=U[W++]}else{if(W=U.next(),W.done)break;X=W.value}var Y=X;p(this,Y)}}}).observe(this,{childList:!0,subtree:!0}),A(this),l(function*(){for(;;)yield E.sleep(L.autosync),n(L)?yield z(L):yield A(L)})()}attachedCallback(){A(this)}static get observedAttributes(){return["autosync","area"]}attributeChangedCallback(L){switch(L){case"autosync":break;case"area":C(this);}}}}function n(K){return K.hasAttribute("autosync")}function o(K,L){var M=[L,...Array.from(L.querySelectorAll("*"))].filter(T=>null!=T.value&&null!=T.name),N=function(U){var V=new MutationObserver(()=>z(K,[U]));V.observe(U,{attributes:!0,atributeFilter:["name"]}),K.componentObservers.set(U,V)};for(var O=M,P=Array.isArray(O),Q=0,O=P?O:O[Symbol.iterator]();;){var R;if(P){if(Q>=O.length)break;R=O[Q++]}else{if(Q=O.next(),Q.done)break;R=Q.value}var S=R;N(S)}}function p(K,L){var M=[L,...Array.from(L.querySelectorAll("*"))];for(var N=M,O=Array.isArray(N),P=0,N=O?N:N[Symbol.iterator]();;){var Q;if(O){if(P>=N.length)break;Q=N[P++]}else{if(P=N.next(),P.done)break;Q=P.value}var R=Q,S=K.componentObservers.get(R);null==S||(K.componentObservers.delete(R),S.disconnect())}}function q(K){return Array.from(K.elements).filter(L=>L.name)}function r(K,L){var M=K.type;return"checkbox"===M||"radio"===M?void(K.checked=L===K.value):void(null==L||null==K.value||(K.value=L))}function s(K){var L=K.type;return"checkbox"===L||"radio"===L?K.checked?K.value:null:K.value}function t(K){var L=K.area;if(!L)return console.error("Require 'area' attribute"),null;var M=G.findHandler(L);return M?M:(console.error("No such area handler: area=%s",K.area),null)}function v(K,L){var M=K.getAttribute(L);return M?M:""}function w(K,L,M){null==M||K.setAttribute(L,M)}function x(K){return Array.from(function*(){for(var L=K,M=Array.isArray(L),N=0,L=M?L:L[Symbol.iterator]();;){var O;if(M){if(N>=L.length)break;O=L[N++]}else{if(N=L.next(),N.done)break;O=N.value}var P=O;for(var Q=P,R=Array.isArray(Q),S=0,Q=R?Q:Q[Symbol.iterator]();;){var T;if(R){if(S>=Q.length)break;T=Q[S++]}else{if(S=Q.next(),S.done)break;T=S.value}var U=T;yield U}}}())}h.__esModule=!0;var y=(()=>{var K=l(function*(L){L.binder&&(yield L.binder.submit(q(L)))});return function(){return K.apply(this,arguments)}})(),z=(()=>{var K=l(function*(L,M){L.binder&&(yield L.binder.sync(M?M:q(L)))});return function(){return K.apply(this,arguments)}})(),A=(()=>{var K=l(function*(L){L.binder&&(yield L.binder.scan(q(L)))});return function(){return K.apply(this,arguments)}})(),B=(()=>{var K=l(function*(L,M){L.binder&&(yield L.binder.remove(M))});return function(){return K.apply(this,arguments)}})(),C=(()=>{var K=l(function*(L){L.binder=null;var M=t(L);M&&(L.binder=new I.default(M,{write:r,read:s}),yield z(L))});return function(){return K.apply(this,arguments)}})();h.mixinStorageForm=m;var D=j(1),E=k(D),F=j(2),G=k(F),H=j(3),I=function(L){return L&&L.__esModule?L:{default:L}}(H),J=m(HTMLFormElement);h.default=class extends J{}}]);
//# sourceMappingURL=storage-elements.js.map