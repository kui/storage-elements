(function(h){function j(l){if(k[l])return k[l].exports;var m=k[l]={exports:{},id:l,loaded:!1};return h[l].call(m.exports,m,m.exports,j),m.loaded=!0,m.exports}var k={};return j.m=h,j.c=k,j.p="",j(0)})([function(h,j,k){"use strict";var l=k(5),m=function(o){return o&&o.__esModule?o:{default:o}}(l);m.default.register()},function(h,j){"use strict";j.__esModule=!0,j.sleep=function(n){var o=void 0;return new k(p=>{o=setTimeout(()=>p(),n)},()=>{clearTimeout(o)})},j.dedup=function(n){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:(p,q)=>p===q;return n.reduce((p,q)=>{if(p.some(r=>o(r,q)));return p.concat(q)},[])},j.subtractSet=function(n,o){return new Set(Array.from(n).filter(p=>!o.has(p)))};class k extends Promise{constructor(m,n){super(m),this.cancellFunction=n}cancell(){this.cancellFunction()}}j.CancellablePromise=k;class l extends Map{*flattenValues(){for(var m=this.values(),n=Array.isArray(m),o=0,m=n?m:m[Symbol.iterator]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{if(o=m.next(),o.done)break;p=o.value}var q=p;for(var r=q,s=Array.isArray(r),t=0,r=s?r:r[Symbol.iterator]();;){var v;if(s){if(t>=r.length)break;v=r[t++]}else{if(t=r.next(),t.done)break;v=t.value}var w=v;yield w}}}}j.ArrayValueMap=class extends l{add(n,o){var p=this.get(n);return p||(p=[],this.set(n,p)),p.push(o),this}},j.SetValueMap=class extends l{add(n,o){var p=this.get(n);return p||(p=new Set,this.set(n,p)),p.add(o),this}}},function(h,j){"use strict";function k(o,p){if(l[o])throw Error(`Already registered handler for "${o}"`);l[o]=p}j.__esModule=!0,j.registerHandler=k,j.findHandler=function(p){return l[p]},j.listHandlers=function(){return Object.entries(l)};var l={};class m{constructor(o){this.storage=o}read(o){return Promise.resolve(this.storage.getItem(o))}write(o,p){return this.storage.setItem(o,p),Promise.resolve()}remove(o){return this.storage.removeItem(o),Promise.resolve()}}j.WebStorageAreaHandler=m,localStorage&&k("local-storage",new m(localStorage)),sessionStorage&&k("session-storage",new m(sessionStorage));class n{constructor(o){this.storage=o}read(o){return new Promise(p=>this.storage.get(o,q=>p(q[o])))}write(o,p){return new Promise(q=>this.storage.set({[o]:p},q))}remove(o){return new Promise(p=>this.storage.remove(o,p))}}j.ChromeStorageAreaHandler=n,chrome&&chrome.storage&&(chrome.storage.local&&k("chrome-local",new n(chrome.storage.local)),chrome.storage.sync&&k("chrome-sync",new n(chrome.storage.sync)))},function(h,j,k){"use strict";function l(v){return function(){var w=v.apply(this,arguments);return new Promise(function(x,y){function z(A,B){try{var C=w[A](B),D=C.value}catch(E){return void y(E)}return C.done?void x(D):Promise.resolve(D).then(function(E){z("next",E)},function(E){z("throw",E)})}return z("next")})}}function m(){for(var v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];for(var y=w,z=Array.isArray(y),A=0,y=z?y:y[Symbol.iterator]();;){var B;if(z){if(A>=y.length)break;B=y[A++]}else{if(A=y.next(),A.done)break;B=A.value}var C=B,D=C();if(null!=D)return D}return null}function n(v,w){for(var x=v.v.values(),y=Array.isArray(x),z=0,x=y?x:x[Symbol.iterator]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{if(z=x.next(),z.done)break;A=z.value}var B=A;if(B.name===w)return B.value}return null}j.__esModule=!0;var o=(()=>{var v=l(function*(w,x){yield Promise.all(x.map((()=>{var y=l(function*(z){yield q(w,z),yield r(w,z)});return function(){return y.apply(this,arguments)}})()))});return function(){return v.apply(this,arguments)}})(),p=(()=>{var v=l(function*(w,x){for(;w.lock;)yield w.lock;w.lock=x(),yield w.lock,w.lock=null});return function(){return v.apply(this,arguments)}})(),q=(()=>{var v=l(function*(w,x){var y=x.name,z=yield w.s.read(y),A=w.v.get(x);A||(A={name:x.name,value:null},w.v.set(x,A)),(A.name!==y||A.value!==z)&&(w.f.write(x,z),A.name=y,A.value=z)});return function(){return v.apply(this,arguments)}})(),r=(()=>{var v=l(function*(w,x){var y=x.name,z=m(function(){return w.f.read(x)},function(){return n(w,y)}),A=w.v.get(x);A||(A={name:x.name,value:null},w.v.set(x,A)),(A.name!==y||A.value!==z)&&(null==z?yield w.s.remove(y):yield w.s.write(y,z),A.name=y,A.value=z)});return function(){return v.apply(this,arguments)}})(),s=k(1),t=function(w){if(w&&w.__esModule)return w;var x={};if(null!=w)for(var y in w)Object.prototype.hasOwnProperty.call(w,y)&&(x[y]=w[y]);return x.default=w,x}(s);j.default=class{constructor(w,x){this.v=new Map,this.s=w,this.f=x,this.lock=null}sync(w){var x=this;return l(function*(){yield p(x,function(){return o(x,w)})})()}submit(w){var x=this;return l(function*(){yield p(x,function(){return Promise.all(w.map((()=>{var y=l(function*(z){yield r(x,z)});return function(){return y.apply(this,arguments)}})()))})})()}scan(w){var x=this;return l(function*(){yield p(x,l(function*(){var y=t.subtractSet(new Set(w),new Set(x.v.keys()));yield o(x,Array.from(y))}))})()}remove(w){var x=this;return l(function*(){yield p(x,l(function*(){for(var y=w,z=Array.isArray(y),A=0,y=z?y:y[Symbol.iterator]();;){var B;if(z){if(A>=y.length)break;B=y[A++]}else{if(A=y.next(),A.done)break;B=A.value}var C=B;x.v.delete(C)}}))})()}}},function(h,j,k){"use strict";function l(H){if(H&&H.__esModule)return H;var I={};if(null!=H)for(var J in H)Object.prototype.hasOwnProperty.call(H,J)&&(I[J]=H[J]);return I.default=H,I}function m(H){return function(){var I=H.apply(this,arguments);return new Promise(function(J,K){function L(M,N){try{var O=I[M](N),P=O.value}catch(Q){return void K(Q)}return O.done?void J(P):Promise.resolve(P).then(function(Q){L("next",Q)},function(Q){L("throw",Q)})}return L("next")})}}function n(H){return class extends H{get area(){return t(this,"area")}set area(I){v(this,"area",I)}constructor(){super()}createdCallback(){var I=this;this.isInitLoad=!0,this.addEventListener("change",()=>y(this)),window.addEventListener("unload",()=>y(this)),m(function*(){for(;;)yield A.sleep(500),yield y(I),q(I)})()}attachedCallback(){0===this.length&&s(this),w(this),q(this)}static get observedAttributes(){return["area"]}attributeChangedCallback(I){"area"===I?w(this):void 0}}}function o(H,I){H.value===I||(H.value=I,q(H))}function p(H){return H.value}function q(H){var I=H.form;null==I||I.setAttribute("area",H.value)}function r(H){var I=H.area;if(!I)return console.error("Require 'area' attribute"),null;var J=C.findHandler(I);return J?J:(console.error("No such area handler: area=%s",H.area),null)}function s(H){for(var I=C.listHandlers(),J=Array.isArray(I),K=0,I=J?I:I[Symbol.iterator]();;){var L;if(J){if(K>=I.length)break;L=I[K++]}else{if(K=I.next(),K.done)break;L=K.value}var M=L,N=M[0],O=document.createElement("option");O.innerHTML=N,H.appendChild(O)}}function t(H,I){var J=H.getAttribute(I);return J?J:""}function v(H,I,J){null==J||H.setAttribute(I,J)}j.__esModule=!0;var w=(()=>{var H=m(function*(I){if(0!==I.options.length){I.binder=null;var J=r(I);J&&(I.binder=new E.default(J,{write:o,read:p}),I.isInitLoad?(I.isInitLoad=!1,yield y(I)):yield x(I))}});return function(){return H.apply(this,arguments)}})(),x=(()=>{var H=m(function*(I){I.binder&&(yield I.binder.submit([I]))});return function(){return H.apply(this,arguments)}})(),y=(()=>{var H=m(function*(I){I.binder&&(yield I.binder.sync([I]))});return function(){return H.apply(this,arguments)}})();j.mixinAreaSelect=n;var z=k(1),A=l(z),B=k(2),C=l(B),D=k(3),E=function(I){return I&&I.__esModule?I:{default:I}}(D),F=n(HTMLSelectElement);class G extends F{static get extends(){return"select"}}j.default=G},function(h,j,k){"use strict";function l(P){return P&&P.__esModule?P:{default:P}}function m(P){if(P&&P.__esModule)return P;var Q={};if(null!=P)for(var R in P)Object.prototype.hasOwnProperty.call(P,R)&&(Q[R]=P[R]);return Q.default=P,Q}function n(P){return function(){var Q=P.apply(this,arguments);return new Promise(function(R,S){function T(U,V){try{var W=Q[U](V),X=W.value}catch(Y){return void S(Y)}return W.done?void R(X):Promise.resolve(X).then(function(Y){T("next",Y)},function(Y){T("throw",Y)})}return T("next")})}}function o(P){return class extends P{get autosync(){var Q=parseInt(x(this,"autosync"));return 0<Q?Q:700}set autosync(Q){y(this,"autosync",Q)}get area(){return x(this,"area")}set area(Q){y(this,"area",Q)}constructor(){super()}createdCallback(){var Q=this;this.isInitLoad=!0,this.componentObservers=new Map,E(this),this.addEventListener("submit",R=>{R.preventDefault(),A(this)}),window.addEventListener("unload",()=>{p(this)&&B(this)}),new MutationObserver(R=>{console.debug("scan by form MutationObserver: ",this),C(this);var S=z(R.map(ca=>ca.addedNodes)).filter(ca=>ca instanceof HTMLElement);if(0<S.length)for(var T=S,U=Array.isArray(T),V=0,T=U?T:T[Symbol.iterator]();;){var W;if(U){if(V>=T.length)break;W=T[V++]}else{if(V=T.next(),V.done)break;W=V.value}var X=W;q(this,X)}var Y=z(R.map(ca=>ca.removedNodes)).filter(ca=>ca instanceof HTMLElement);if(0<Y.length){D(this,Y.filter(ca=>ca.name));for(var Z=Y,$=Array.isArray(Z),_=0,Z=$?Z:Z[Symbol.iterator]();;){var aa;if($){if(_>=Z.length)break;aa=Z[_++]}else{if(_=Z.next(),_.done)break;aa=_.value}var ba=aa;r(this,ba)}}}).observe(this,{childList:!0,subtree:!0}),C(this),n(function*(){for(;;)yield G.sleep(Q.autosync),p(Q)?yield B(Q):yield C(Q)})()}attachedCallback(){C(this)}static get observedAttributes(){return["autosync","area"]}attributeChangedCallback(Q){switch(Q){case"autosync":break;case"area":E(this);}}}}function p(P){return P.hasAttribute("autosync")}function q(P,Q){var R=[Q,...Array.from(Q.querySelectorAll("*"))].filter(Y=>null!=Y.value&&null!=Y.name),S=function(Z){var $=new MutationObserver(()=>B(P,[Z]));$.observe(Z,{attributes:!0,atributeFilter:["name"]}),P.componentObservers.set(Z,$)};for(var T=R,U=Array.isArray(T),V=0,T=U?T:T[Symbol.iterator]();;){var W;if(U){if(V>=T.length)break;W=T[V++]}else{if(V=T.next(),V.done)break;W=V.value}var X=W;S(X)}}function r(P,Q){var R=[Q,...Array.from(Q.querySelectorAll("*"))];for(var S=R,T=Array.isArray(S),U=0,S=T?S:S[Symbol.iterator]();;){var V;if(T){if(U>=S.length)break;V=S[U++]}else{if(U=S.next(),U.done)break;V=U.value}var W=V,X=P.componentObservers.get(W);null==X||(P.componentObservers.delete(W),X.disconnect())}}function s(P){return Array.from(P.elements).filter(Q=>Q.name).filter(Q=>!(Q instanceof M.default))}function t(P,Q){var R=P.type;return"checkbox"===R||"radio"===R?void(P.checked=Q===P.value):void(null==Q||null==P.value||(P.value=Q))}function v(P){var Q=P.type;return"checkbox"===Q||"radio"===Q?P.checked?P.value:null:P.value}function w(P){var Q=P.area;if(!Q)return console.error("Require 'area' attribute"),null;var R=K.findHandler(Q);return R?R:(console.error("No such area handler: area=%s",P.area),null)}function x(P,Q){var R=P.getAttribute(Q);return R?R:""}function y(P,Q,R){null==R||P.setAttribute(Q,R)}function z(P){return Array.from(function*(){for(var Q=P,R=Array.isArray(Q),S=0,Q=R?Q:Q[Symbol.iterator]();;){var T;if(R){if(S>=Q.length)break;T=Q[S++]}else{if(S=Q.next(),S.done)break;T=S.value}var U=T;for(var V=U,W=Array.isArray(V),X=0,V=W?V:V[Symbol.iterator]();;){var Y;if(W){if(X>=V.length)break;Y=V[X++]}else{if(X=V.next(),X.done)break;Y=X.value}var Z=Y;yield Z}}}())}j.__esModule=!0;var A=(()=>{var P=n(function*(Q){Q.binder&&(yield Q.binder.submit(s(Q)))});return function(){return P.apply(this,arguments)}})(),B=(()=>{var P=n(function*(Q,R){Q.binder&&(yield Q.binder.sync(R?R:s(Q)))});return function(){return P.apply(this,arguments)}})(),C=(()=>{var P=n(function*(Q){Q.binder&&(yield Q.binder.scan(s(Q)))});return function(){return P.apply(this,arguments)}})(),D=(()=>{var P=n(function*(Q,R){Q.binder&&(yield Q.binder.remove(R))});return function(){return P.apply(this,arguments)}})(),E=(()=>{var P=n(function*(Q){Q.binder=null;var R=w(Q);R&&(Q.binder=new I.default(R,{write:t,read:v}),Q.isInitLoad?(Q.isInitLoad=!1,yield B(Q)):yield A(Q))});return function(){return P.apply(this,arguments)}})();j.mixinStorageForm=o;var F=k(1),G=m(F),H=k(3),I=l(H),J=k(2),K=m(J),L=k(4),M=l(L),N=o(HTMLFormElement);class O extends N{static get extends(){return"form"}static register(){document.registerElement("storage-form",O),document.registerElement("area-select",M.default)}}j.default=O}]);
//# sourceMappingURL=storage-elements.js.map